# Тестовое задание на позицию DevOps

## Запуск программы
1. Скопировать репозиторий через `git clone`
2. В корне репозитория ввести `bash run.sh <server1>,<server2>`

## Поиск наименее загруженного сервера
Под этим может пониматься загрузка по CPU, RAM, или памяти на вторичном хранилище. Поэтому для определения наименее нагруженного сервера использовались все три параметра. Для этого я нормировал параметры с помощью сигмоиды и вычисленных заранее коэффициентов для каждого параметра, после чего находил среднее из трех. Сервер с наименьшим показателем загрузки выбирается целевым

## Основная логика

### Целевой сервер
1. На целевом сервере через Ansible автоматически устанавливаются зависимости (docker, docker-compose).
2. Загружается папка database/, содержащая docker-compose.yaml и миграции для базы данных.
3. Поднимается контейнер с PostgreSQL и выполняется миграция с помощью Flyway.
4. Настраивается доступ к базе данных только с указанных серверов через автоматическую генерацию и установку файла pg_hba.conf.

### Сервера подключения
Если сервер не целевой - значит на нём с помощью ansible устанавливается postgres-client, ip-адрес сервера добавляется в список тех, с которых можно подключиться к пользователю student